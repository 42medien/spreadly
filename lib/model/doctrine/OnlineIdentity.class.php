<?php

/**
 * OnlineIdentity
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 *
 * @package    yiid
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class OnlineIdentity extends BaseOnlineIdentity
{

  protected $aPostApiClient = null;

  /**
   * builds the real profile-url using the identifier
   * @deprecated use $this->getProfileUri() now
   * @return string
   */
  public function getUrl() {
    return $this->getProfileUri();
  }

  /**
   * send status-message (for example like)
   *
   * @author Matthias Pfefferle
   * @param string $pUrl
   * @param string $pType
   * @param int $pScore
   * @param string $pTitle
   * @return int
   */
  public function sendStatusMessage($pUrl, $pType, $pScore, $pTitle, $pDescription, $pPhoto) {
    sfContext::getInstance()->getLogger()->err("{OnlineIdentity} trying to send with: ".$this->getId()." (Community ID: ".$this->getCommunityId().") msg: ". $pTitle);

    $this->aPostApiClient = PostApiFactory::factory($this->getCommunity()->getCommunity());
    if ($this->aPostApiClient) {
      $lStatus = $this->aPostApiClient->doPost($this, $pUrl, $pType, $pScore, $pTitle, $pDescription, $pPhoto);
      return $lStatus;
    } else {
      try {
        sfContext::getInstance()->getLogger()->err("{OnlineIdentity} missing PostApiFactory for OnlineIdentity: ".$this->getId()." (Community ID: ".$this->getCommunityId().")");
      } catch (Exception $e) {}
    }
  }

  public function getOAuthToken(){
  }

  public function getCommunity() {
    return CommunityTable::getInstance()->retrieveByPk($this->getCommunityId());
  }
}